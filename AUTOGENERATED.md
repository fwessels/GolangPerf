# AUTOGENERATED

As part of examining a bug I noticed the following piece of the call stack:

```
   cmd.retryStorage.ListDir(0x12847c0, 0xc420402e70, 0x1, 0xf4240, 0x4c4b40, 0xdf3b5f, 0xe, 0xf18f1ec540, 0x25, 0xf18f1ec564, ...)
                           /home/builder/mygo/src/github.com/minio/minio/cmd/retry-storage.go:183 +0x72

cmd.(*retryStorage).ListDir(0xc4201624b0, 0xdf3b5f, 0xe, 0xf18f1ec540, 0x25, 0x25, 0x1, 0x25, 0x25, 0x25)
                           :932 +0xaf

       cmd.cleanupDir.func1(0xf18f1ec540, 0x25, 0x24, 0xde7eb5)
                           /home/builder/mygo/src/github.com/minio/minio/cmd/object-api-common.go:215 +0xe1
                                                                   
             cmd.cleanupDir(0x1284860, 0xc4201624b0, 0xdf3b5f, 0xe, 0xf498fc5590, 0x24, 0x45d9b1, 0xc420144070)
                           /home/builder/mygo/src/github.com/minio/minio/cmd/object-api-common.go:231 +0x1d1

```

which was originating from the following function:

```go
// Cleanup a directory recursively.
func cleanupDir(storage StorageAPI, volume, dirPath string) error {
	var delFunc func(string) error
	// Function to delete entries recursively.
	delFunc = func(entryPath string) error {
		if !hasSuffix(entryPath, slashSeparator) {
			// Delete the file entry.
			return traceError(storage.DeleteFile(volume, entryPath))
		}

		// If it's a directory, list and call delFunc() for each entry.
		entries, err := storage.ListDir(volume, entryPath)
		// If entryPath prefix never existed, safe to ignore.
		if err == errFileNotFound {
			return nil
		} else if err != nil { // For any other errors fail.
			return traceError(err)
		} // else on success..

		// Recurse and delete all other entries.
		for _, entry := range entries {
			if err = delFunc(pathJoin(entryPath, entry)); err != nil {
				return err
			}
		}
		return nil
	}
	err := delFunc(retainSlash(pathJoin(dirPath)))
	return err
}
```

So apparently `storage` is passed implicitly _by pointer_ to `delFunc` in order to be able to call `ListDir`.

The (by the compiler) autogenerated `(*retryStorage).ListDir` --also notice the `:932` in the call stack-- in turn calls the `func (f retryStorage) ListDir` as defined in our code.

This is confirmed by running `go tool objdump -s ListDir minio` which shows the autogenerated function (that creates a copy of `storage` on the stack and also copies the return values from ListDir as its own results):
```
TEXT github.com/minio/minio/cmd.(*retryStorage).ListDir(SB) <autogenerated>
	<autogenerated>:926	0x1f2e00	65488b0c25a0080000	GS MOVQ GS:0x8a0, CX
	<autogenerated>:926	0x1f2e09	483b6110		CMPQ 0x10(CX), SP
	<autogenerated>:926	0x1f2e0d	0f862f010000		JBE 0x1f2f42
	<autogenerated>:926	0x1f2e13	4883ec78		SUBQ $0x78, SP
	<autogenerated>:926	0x1f2e17	48896c2470		MOVQ BP, 0x70(SP)
	<autogenerated>:926	0x1f2e1c	488d6c2470		LEAQ 0x70(SP), BP
	<autogenerated>:926	0x1f2e21	488b5920		MOVQ 0x20(CX), BX
	<autogenerated>:926	0x1f2e25	4885db			TESTQ BX, BX
	<autogenerated>:926	0x1f2e28	7410			JE 0x1f2e3a
	<autogenerated>:926	0x1f2e2a	488dbc2480000000	LEAQ 0x80(SP), DI
	<autogenerated>:926	0x1f2e32	48393b			CMPQ DI, 0(BX)
	<autogenerated>:926	0x1f2e35	7503			JNE 0x1f2e3a
	<autogenerated>:926	0x1f2e37	488923			MOVQ SP, 0(BX)
	<autogenerated>:926	0x1f2e3a	488b842480000000	MOVQ 0x80(SP), AX
	<autogenerated>:926	0x1f2e42	4885c0			TESTQ AX, AX
	<autogenerated>:926	0x1f2e45	0f84af000000		JE 0x1f2efa
	<autogenerated>:926	0x1f2e4b	488b842480000000	MOVQ 0x80(SP), AX
	<autogenerated>:926	0x1f2e53	488b08			MOVQ 0(AX), CX
	<autogenerated>:926	0x1f2e56	48890c24		MOVQ CX, 0(SP)
	<autogenerated>:926	0x1f2e5a	488d7008		LEAQ 0x8(AX), SI
	<autogenerated>:926	0x1f2e5e	488d7c2408		LEAQ 0x8(SP), DI
	<autogenerated>:926	0x1f2e63	48896c24f0		MOVQ BP, -0x10(SP)
	<autogenerated>:926	0x1f2e68	488d6c24f0		LEAQ -0x10(SP), BP
	<autogenerated>:926	0x1f2e6d	e832a7e6ff		CALL 0x5d5a4
	<autogenerated>:926	0x1f2e72	488b6d00		MOVQ 0(BP), BP
	<autogenerated>:926	0x1f2e76	488b842488000000	MOVQ 0x88(SP), AX
	<autogenerated>:926	0x1f2e7e	4889442428		MOVQ AX, 0x28(SP)
	<autogenerated>:926	0x1f2e83	488b842490000000	MOVQ 0x90(SP), AX
	<autogenerated>:926	0x1f2e8b	4889442430		MOVQ AX, 0x30(SP)
	<autogenerated>:926	0x1f2e90	488b842498000000	MOVQ 0x98(SP), AX
	<autogenerated>:926	0x1f2e98	4889442438		MOVQ AX, 0x38(SP)
	<autogenerated>:926	0x1f2e9d	488b8424a0000000	MOVQ 0xa0(SP), AX
	<autogenerated>:926	0x1f2ea5	4889442440		MOVQ AX, 0x40(SP)
	<autogenerated>:926	0x1f2eaa	e811bff6ff		CALL github.com/minio/minio/cmd.retryStorage.ListDir(SB)
	<autogenerated>:926	0x1f2eaf	488b442448		MOVQ 0x48(SP), AX
	<autogenerated>:926	0x1f2eb4	488b4c2450		MOVQ 0x50(SP), CX
	<autogenerated>:926	0x1f2eb9	488b542458		MOVQ 0x58(SP), DX
	<autogenerated>:926	0x1f2ebe	488b5c2460		MOVQ 0x60(SP), BX
	<autogenerated>:926	0x1f2ec3	488b742468		MOVQ 0x68(SP), SI
	<autogenerated>:926	0x1f2ec8	48898424a8000000	MOVQ AX, 0xa8(SP)
	<autogenerated>:926	0x1f2ed0	48898c24b0000000	MOVQ CX, 0xb0(SP)
	<autogenerated>:926	0x1f2ed8	48899424b8000000	MOVQ DX, 0xb8(SP)
	<autogenerated>:926	0x1f2ee0	48899c24c0000000	MOVQ BX, 0xc0(SP)
	<autogenerated>:926	0x1f2ee8	4889b424c8000000	MOVQ SI, 0xc8(SP)
	<autogenerated>:926	0x1f2ef0	488b6c2470		MOVQ 0x70(SP), BP
	<autogenerated>:926	0x1f2ef5	4883c478		ADDQ $0x78, SP
	<autogenerated>:926	0x1f2ef9	c3			RET
	<autogenerated>:926	0x1f2efa	488d05bbc29600		LEAQ 0x96c2bb(IP), AX
	<autogenerated>:926	0x1f2f01	48890424		MOVQ AX, 0(SP)
	<autogenerated>:926	0x1f2f05	48c744240803000000	MOVQ $0x3, 0x8(SP)
	<autogenerated>:926	0x1f2f0e	488d0570689700		LEAQ 0x976870(IP), AX
	<autogenerated>:926	0x1f2f15	4889442410		MOVQ AX, 0x10(SP)
	<autogenerated>:926	0x1f2f1a	48c74424180c000000	MOVQ $0xc, 0x18(SP)
	<autogenerated>:926	0x1f2f23	488d05a2079700		LEAQ 0x9707a2(IP), AX
	<autogenerated>:926	0x1f2f2a	4889442420		MOVQ AX, 0x20(SP)
	<autogenerated>:926	0x1f2f2f	48c744242807000000	MOVQ $0x7, 0x28(SP)
	<autogenerated>:926	0x1f2f38	e8035ee1ff		CALL runtime.panicwrap(SB)
	<autogenerated>:926	0x1f2f3d	e909ffffff		JMP 0x1f2e4b
	<autogenerated>:926	0x1f2f42	e86973e6ff		CALL runtime.morestack_noctxt(SB)
	<autogenerated>:926	0x1f2f47	e9b4feffff		JMP github.com/minio/minio/cmd.(*retryStorage).ListDir(SB)
	:-1			0x1f2f4c	cc			INT $0x3
	:-1			0x1f2f4d	cc			INT $0x3
	:-1			0x1f2f4e	cc			INT $0x3
	:-1			0x1f2f4f	cc			INT $0x3
```

Changing `func (f retryStorage) ListDir`  to `func (f *retryStorage) ListDir` cause to autogenerated version to disappear (obviously) as follows:

```
TEXT github.com/minio/minio/cmd.(*retryStorage).ListDir(SB) /Users/frankw/golang/src/github.com/minio/minio/cmd/retry-storage.go
	retry-storage.go:199	0x15edc0	65488b0c25a0080000	GS MOVQ GS:0x8a0, CX
	retry-storage.go:199	0x15edc9	483b6110		CMPQ 0x10(CX), SP
	retry-storage.go:199	0x15edcd	0f8612020000		JBE 0x15efe5
	retry-storage.go:199	0x15edd3	4881ec80000000		SUBQ $0x80, SP
	retry-storage.go:199	0x15edda	48896c2478		MOVQ BP, 0x78(SP)
	retry-storage.go:199	0x15eddf	488d6c2478		LEAQ 0x78(SP), BP
	retry-storage.go:200	0x15ede4	488b842488000000	MOVQ 0x88(SP), AX
	retry-storage.go:200	0x15edec	488b08			MOVQ 0(AX), CX
	retry-storage.go:200	0x15edef	488b4950		MOVQ 0x50(CX), CX
	retry-storage.go:200	0x15edf3	488b5008		MOVQ 0x8(AX), DX
	retry-storage.go:200	0x15edf7	488b9c2490000000	MOVQ 0x90(SP), BX
	retry-storage.go:200	0x15edff	48895c2408		MOVQ BX, 0x8(SP)
	retry-storage.go:200	0x15ee04	488bb42498000000	MOVQ 0x98(SP), SI
	retry-storage.go:200	0x15ee0c	4889742410		MOVQ SI, 0x10(SP)
	retry-storage.go:200	0x15ee11	488bbc24a0000000	MOVQ 0xa0(SP), DI
	retry-storage.go:200	0x15ee19	48897c2418		MOVQ DI, 0x18(SP)
	retry-storage.go:200	0x15ee1e	4c8b8424a8000000	MOVQ 0xa8(SP), R8
	retry-storage.go:200	0x15ee26	4c89442420		MOVQ R8, 0x20(SP)
	retry-storage.go:200	0x15ee2b	48891424		MOVQ DX, 0(SP)
	retry-storage.go:200	0x15ee2f	ffd1			CALL CX
	retry-storage.go:200	0x15ee31	488b442448		MOVQ 0x48(SP), AX
	retry-storage.go:200	0x15ee36	4889442470		MOVQ AX, 0x70(SP)
	retry-storage.go:200	0x15ee3b	488b4c2440		MOVQ 0x40(SP), CX
	retry-storage.go:200	0x15ee40	48894c2468		MOVQ CX, 0x68(SP)
	retry-storage.go:200	0x15ee45	488b542438		MOVQ 0x38(SP), DX
	retry-storage.go:200	0x15ee4a	4889542458		MOVQ DX, 0x58(SP)
	retry-storage.go:200	0x15ee4f	488b5c2428		MOVQ 0x28(SP), BX
	retry-storage.go:200	0x15ee54	48895c2460		MOVQ BX, 0x60(SP)
	retry-storage.go:200	0x15ee59	488b742430		MOVQ 0x30(SP), SI
	retry-storage.go:200	0x15ee5e	4889742450		MOVQ SI, 0x50(SP)
	retry-storage.go:201	0x15ee63	488b3da6761d01		MOVQ 0x11d76a6(IP), DI
	retry-storage.go:201	0x15ee6a	4839f9			CMPQ DI, CX
	retry-storage.go:201	0x15ee6d	7435			JE 0x15eea4
	retry-storage.go:207	0x15ee6f	48899c24b0000000	MOVQ BX, 0xb0(SP)
	retry-storage.go:207	0x15ee77	4889b424b8000000	MOVQ SI, 0xb8(SP)
	retry-storage.go:207	0x15ee7f	48899424c0000000	MOVQ DX, 0xc0(SP)
	retry-storage.go:207	0x15ee87	48898c24c8000000	MOVQ CX, 0xc8(SP)
	retry-storage.go:207	0x15ee8f	48898424d0000000	MOVQ AX, 0xd0(SP)
	retry-storage.go:207	0x15ee97	488b6c2478		MOVQ 0x78(SP), BP
	retry-storage.go:207	0x15ee9c	4881c480000000		ADDQ $0x80, SP
	retry-storage.go:207	0x15eea3	c3			RET
	retry-storage.go:201	0x15eea4	48890c24		MOVQ CX, 0(SP)
	retry-storage.go:201	0x15eea8	4889442408		MOVQ AX, 0x8(SP)
	retry-storage.go:201	0x15eead	488b3d5c761d01		MOVQ 0x11d765c(IP), DI
	retry-storage.go:201	0x15eeb4	4c8b055d761d01		MOVQ 0x11d765d(IP), R8
	retry-storage.go:201	0x15eebb	48897c2410		MOVQ DI, 0x10(SP)
	retry-storage.go:201	0x15eec0	4c89442418		MOVQ R8, 0x18(SP)
	retry-storage.go:201	0x15eec5	e85644eaff		CALL runtime.ifaceeq(SB)
	retry-storage.go:201	0x15eeca	0fb6442420		MOVZX 0x20(SP), AX
	retry-storage.go:201	0x15eecf	84c0			TESTL AL, AL
	retry-storage.go:201	0x15eed1	751b			JNE 0x15eeee
	retry-storage.go:200	0x15eed3	488b542458		MOVQ 0x58(SP), DX
	retry-storage.go:200	0x15eed8	488b5c2460		MOVQ 0x60(SP), BX
	retry-storage.go:200	0x15eedd	488b742450		MOVQ 0x50(SP), SI
	retry-storage.go:200	0x15eee2	488b4c2468		MOVQ 0x68(SP), CX
	retry-storage.go:200	0x15eee7	488b442470		MOVQ 0x70(SP), AX
	retry-storage.go:207	0x15eeec	eb81			JMP 0x15ee6f
	retry-storage.go:202	0x15eeee	488b842488000000	MOVQ 0x88(SP), AX
	retry-storage.go:202	0x15eef6	488b08			MOVQ 0(AX), CX
	retry-storage.go:202	0x15eef9	48890c24		MOVQ CX, 0(SP)
	retry-storage.go:202	0x15eefd	488d7008		LEAQ 0x8(AX), SI
	retry-storage.go:202	0x15ef01	488d7c2408		LEAQ 0x8(SP), DI
	retry-storage.go:202	0x15ef06	48896c24f0		MOVQ BP, -0x10(SP)
	retry-storage.go:202	0x15ef0b	488d6c24f0		LEAQ -0x10(SP), BP
	retry-storage.go:202	0x15ef10	e88fe6efff		CALL 0x5d5a4
	retry-storage.go:202	0x15ef15	488b6d00		MOVQ 0(BP), BP
	retry-storage.go:202	0x15ef19	e882040000		CALL github.com/minio/minio/cmd.retryStorage.reInit(SB)
	retry-storage.go:202	0x15ef1e	488b442428		MOVQ 0x28(SP), AX
	retry-storage.go:202	0x15ef23	488b4c2430		MOVQ 0x30(SP), CX
	retry-storage.go:203	0x15ef28	4885c0			TESTQ AX, AX
	retry-storage.go:203	0x15ef2b	741d			JE 0x15ef4a
	retry-storage.go:200	0x15ef2d	488b542458		MOVQ 0x58(SP), DX
	retry-storage.go:200	0x15ef32	488b5c2460		MOVQ 0x60(SP), BX
	retry-storage.go:200	0x15ef37	488b742450		MOVQ 0x50(SP), SI
	retry-storage.go:202	0x15ef3c	4889cf			MOVQ CX, DI
	retry-storage.go:202	0x15ef3f	4889c1			MOVQ AX, CX
	retry-storage.go:202	0x15ef42	4889f8			MOVQ DI, AX
	retry-storage.go:207	0x15ef45	e925ffffff		JMP 0x15ee6f
	retry-storage.go:204	0x15ef4a	488b842488000000	MOVQ 0x88(SP), AX
	retry-storage.go:204	0x15ef52	488b08			MOVQ 0(AX), CX
	retry-storage.go:204	0x15ef55	488b4950		MOVQ 0x50(CX), CX
	retry-storage.go:204	0x15ef59	488b5008		MOVQ 0x8(AX), DX
	retry-storage.go:204	0x15ef5d	488b9c2490000000	MOVQ 0x90(SP), BX
	retry-storage.go:204	0x15ef65	48895c2408		MOVQ BX, 0x8(SP)
	retry-storage.go:204	0x15ef6a	488b9c2498000000	MOVQ 0x98(SP), BX
	retry-storage.go:204	0x15ef72	48895c2410		MOVQ BX, 0x10(SP)
	retry-storage.go:204	0x15ef77	488b9c24a0000000	MOVQ 0xa0(SP), BX
	retry-storage.go:204	0x15ef7f	48895c2418		MOVQ BX, 0x18(SP)
	retry-storage.go:204	0x15ef84	488b9c24a8000000	MOVQ 0xa8(SP), BX
	retry-storage.go:204	0x15ef8c	48895c2420		MOVQ BX, 0x20(SP)
	retry-storage.go:204	0x15ef91	48891424		MOVQ DX, 0(SP)
	retry-storage.go:204	0x15ef95	ffd1			CALL CX
	retry-storage.go:204	0x15ef97	488b442428		MOVQ 0x28(SP), AX
	retry-storage.go:204	0x15ef9c	488b4c2430		MOVQ 0x30(SP), CX
	retry-storage.go:204	0x15efa1	488b542438		MOVQ 0x38(SP), DX
	retry-storage.go:204	0x15efa6	488b5c2440		MOVQ 0x40(SP), BX
	retry-storage.go:204	0x15efab	488b742448		MOVQ 0x48(SP), SI
	retry-storage.go:204	0x15efb0	48898424b0000000	MOVQ AX, 0xb0(SP)
	retry-storage.go:204	0x15efb8	48898c24b8000000	MOVQ CX, 0xb8(SP)
	retry-storage.go:204	0x15efc0	48899424c0000000	MOVQ DX, 0xc0(SP)
	retry-storage.go:204	0x15efc8	48899c24c8000000	MOVQ BX, 0xc8(SP)
	retry-storage.go:204	0x15efd0	4889b424d0000000	MOVQ SI, 0xd0(SP)
	retry-storage.go:204	0x15efd8	488b6c2478		MOVQ 0x78(SP), BP
	retry-storage.go:204	0x15efdd	4881c480000000		ADDQ $0x80, SP
	retry-storage.go:204	0x15efe4	c3			RET
	retry-storage.go:199	0x15efe5	e8c6b2efff		CALL runtime.morestack_noctxt(SB)
	retry-storage.go:199	0x15efea	e9d1fdffff		JMP github.com/minio/minio/cmd.(*retryStorage).ListDir(SB)
	:-1			0x15efef	cc			INT $0x3
```